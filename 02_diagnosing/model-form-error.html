
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7.1. Model-Form Error and Validation &#8212; All Models Are Uncertain</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Advancing" href="../03_advancing/advancing.html" />
    <link rel="prev" title="7. Functions" href="functions.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">All Models Are Uncertain</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_frontmatter/landing-page.html">
   All Models Are Uncertain
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Orienting
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01_orienting/orienting.html">
   1. Orienting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_orienting/modeling-questions.html">
   2. Types of Modeling Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_orienting/curiosity-skepticism.html">
   3. Curiosity and Skepticism: A Healthy Mindset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_orienting/grama-intro.html">
   4. A Grammar of Model Analysis: Grama
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Diagnosing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="diagnosing.html">
   5. Diagnosing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uncertainty.html">
     5.2. Conceptual Tools for Handling Uncertainty
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="distributions.html">
   6. Distributions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="marginals.html">
     6.2. Single-uncertainties: Marginal Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dependency.html">
     6.3. Multiple-uncertainties: Copulas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="estimation.html">
     6.4. Dealing with Limited Data: Estimation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="functions.html">
   7. Functions
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     7.1. Model-Form Error and Validation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Advancing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../03_advancing/advancing.html">
   8. Advancing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../zbib.html">
   9. Bibliography
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04_appendices/cases.html">
   10. Cases
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_appendices/alloys.html">
     10.10. Alloy Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/grama.html">
   11. Grama Reference Materials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/eda.html">
   12. Basics of Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/pr-modeling.html">
   13. Probability and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/dim-reduction.html">
   14. Dimension Reduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/empirical-models.html">
   15. Empirical Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_appendices/fwd-propagation.html">
   16. Forward Propagation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04_appendices/inv-propagation.html">
   17. Inverse Propagation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_appendices/nls.html">
     17.1. Nonlinear Least Squares
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/02_diagnosing/model-form-error.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/02_diagnosing/model-form-error.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#case-study-predicting-a-projectile-trajectory">
   7.1.1. Case Study: Predicting a projectile trajectory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-the-model">
   7.1.2. Define the Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implement-the-model">
   7.1.3. Implement the model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-the-model-with-nonlinear-least-squares">
   7.1.4. Fit the Model with Nonlinear Least Squares
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspect-the-residuals">
   7.1.5. Inspect the Residuals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspect-model-with-validation-data">
   7.1.6. Inspect Model with Validation Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   7.1.7. Exercise
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recognize-model-form-error">
   7.1.8. Recognize Model-form Error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#address-model-form-errors">
   7.1.9. Address Model-form Errors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key-takeaways">
   7.1.10. Key Takeaways
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="model-form-error-and-validation">
<span id="model-form-error"></span><h1><span class="section-number">7.1. </span>Model-Form Error and Validation<a class="headerlink" href="#model-form-error-and-validation" title="Permalink to this headline">¶</a></h1>
<p>Most science and engineering textbooks discuss successful cases of physical modeling, but a key part of developing a model is learning how to identify and fix model errors. <em>Validation</em> is the systematic procedure of testing a model with the endgoal of either showing the model is sufficiently accurate, or of detecting errors in the model to be fixed.</p>
<p><strong>Learning Objectives</strong> In this chapter, you will learn</p>
<ul class="simple">
<li><p>how to use <em>nonlinear least squares</em> to fit a model</p></li>
<li><p>how to inspect <em>residual plots</em> to diagnose fitting issues</p></li>
<li><p>the importance of <em>validation data</em> for assessing a model</p></li>
<li><p>how to recognize <em>model-form error</em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">grama</span> <span class="k">as</span> <span class="nn">gr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Intention</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="case-study-predicting-a-projectile-trajectory">
<h2><span class="section-number">7.1.1. </span>Case Study: Predicting a projectile trajectory<a class="headerlink" href="#case-study-predicting-a-projectile-trajectory" title="Permalink to this headline">¶</a></h2>
<p>Our aim in this case study is to build a model to predict the trajectory of a projectile. We will use a dataset to fit unknown constants in a physics-based model, and perform validation to determine if the model is sufficiently accurate for our purposes.</p>
<p>To start, we will first load and inspect the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_full</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/c01_meas_full.csv&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;Full&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">df_windowed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/c01_meas_windowed.csv&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;Windowed&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">df_full</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">df_windowed</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    
    <span class="o">+</span> <span class="n">scale_color_manual</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">Full</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">Windowed</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Residual&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Range (m)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Height (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/model-form-error_4_0.png" src="../_images/model-form-error_4_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781378239237)&gt;
</pre></div>
</div>
</div>
</div>
<p>The projectile started at coordinates <code class="docutils literal notranslate"><span class="pre">x=0,</span> <span class="pre">y=0</span></code> and was launched diagonally. We actually have two sources of data; a Full set of data from launch to landing, and a Windowed set of data that covers only a fraction of the trajectory. Based on visual inspection, we can see that the data seem to be corrupted by measurement noise.</p>
</div>
<div class="section" id="define-the-model">
<h2><span class="section-number">7.1.2. </span>Define the Model<a class="headerlink" href="#define-the-model" title="Permalink to this headline">¶</a></h2>
<p>We consider a projectile of fixed mass subject to gravity and drag. We consider a dynamical model for the velocity <span class="math notranslate nohighlight">\(u=dx/dt, v=dy/dt\)</span> given by</p>
<div class="math notranslate nohighlight">
\[m \frac{du}{dt} = F_x(u, v),\]</div>
<div class="math notranslate nohighlight">
\[m \frac{dv}{dt} = F_y(u, v) - m g,\]</div>
<p>with a linear drag law</p>
<div class="math notranslate nohighlight">
\[F_x(u, v) = - b u,\]</div>
<div class="math notranslate nohighlight">
\[F_y(u, v) = - b v.\]</div>
<p>This model admits an analytical solution</p>
<div class="math notranslate nohighlight">
\[x = \tau u_0 (1 - \exp(-t/\tau)) + x_0,\]</div>
<div class="math notranslate nohighlight">
\[y = \tau (v_0 - v_{\infty})(1 - \exp(-t/\tau)) + v_{\infty} t + y_0,\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau = m/b\)</span> is the characteristic time, and <span class="math notranslate nohighlight">\(v_{\infty} = g \tau\)</span> is the terminal velocity.</p>
<p>Since <span class="math notranslate nohighlight">\(x_0, y_0\)</span> are known, we have just three unknown quantities to fit:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Sym.</p></th>
<th class="head"><p>Quantity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u_0\)</span></p></td>
<td><p>Initial velocity; horizontal</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(v_0\)</span></p></td>
<td><p>Initial velocity; vertical</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\tau\)</span></p></td>
<td><p>Characteristic time</p></td>
</tr>
</tbody>
</table>
<p>Below we will need plausible ranges for <span class="math notranslate nohighlight">\(u_0, v_0, \tau\)</span> in order to fit these values. To that end, let’s perform a coarse analysis of the available data. For <span class="math notranslate nohighlight">\(u_0, v_0\)</span> we will simply study the observed velocity components, estimated by simple finite differences. For the time constant <span class="math notranslate nohighlight">\(\tau\)</span> we will study the relationship between the (finite-difference based) speed and acceleration. These will be very crude estimates, but they will set an appropriate sense of scale for the values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_speeds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_full</span>
    <span class="c1">## Approximate velocities with finite differences</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span>
        <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">),</span>
        <span class="n">v</span><span class="o">=</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1">## Compute speed from component velocities</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">## Approximate acceleration with finite differences</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">))</span>
    <span class="c1">## Statistics of absolute values</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span>
        <span class="n">u_abs</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">u</span><span class="p">),</span>
        <span class="n">v_abs</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">v</span><span class="p">),</span>
        <span class="n">tau_abs</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">s</span> <span class="o">/</span> <span class="n">X</span><span class="o">.</span><span class="n">a</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_select</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">u_abs</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">v_abs</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">tau_abs</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">df_speeds</span> <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>u_abs</th>
      <th>v_abs</th>
      <th>tau_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>38.000000</td>
      <td>38.00000</td>
      <td>37.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>9.710526</td>
      <td>12.50000</td>
      <td>1.314464</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.367106</td>
      <td>8.76649</td>
      <td>2.467240</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>1.00000</td>
      <td>0.064224</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>6.000000</td>
      <td>5.00000</td>
      <td>0.214345</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>9.000000</td>
      <td>11.00000</td>
      <td>0.503272</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>13.750000</td>
      <td>19.50000</td>
      <td>1.179365</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.000000</td>
      <td>33.00000</td>
      <td>13.816485</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We will use the data above to set informed lower-bounds on the quantities. While the max values are not realistic for best-fit values, we will set them as an upper bound to help focus the parameter search below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u0_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_speeds</span><span class="o">.</span><span class="n">u_abs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_speeds</span><span class="o">.</span><span class="n">u_abs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">v0_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_speeds</span><span class="o">.</span><span class="n">v_abs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_speeds</span><span class="o">.</span><span class="n">v_abs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">tau_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_speeds</span><span class="o">.</span><span class="n">tau_abs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_speeds</span><span class="o">.</span><span class="n">tau_abs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;u0: &quot;</span><span class="p">,</span> <span class="n">u0_bounds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v0: &quot;</span><span class="p">,</span> <span class="n">v0_bounds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tau: &quot;</span><span class="p">,</span> <span class="n">tau_bounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>u0:  (0.0, 22.000000000000014)
v0:  (0.9999999999999778, 32.99999999999998)
tau:  (0.06422436149609652, 13.816485066214396)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="implement-the-model">
<h2><span class="section-number">7.1.3. </span>Implement the model<a class="headerlink" href="#implement-the-model" title="Permalink to this headline">¶</a></h2>
<p>Here we implement the model described above in Grama. We will use this with a fitting routine to estimate best-fit values for <span class="math notranslate nohighlight">\(u_0, v_0, \tau\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Constants</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Initial x-position (m)</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Initial y-position (m)</span>
<span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.8</span> <span class="c1"># Gravitational acceleration (m/s^2)</span>

<span class="c1">## Responses (x and y trajectory components)</span>
<span class="k">def</span> <span class="nf">fun_x</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">u0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="n">tau</span><span class="p">))</span> <span class="o">+</span> <span class="n">x0</span>

<span class="k">def</span> <span class="nf">fun_y</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">v_inf</span> <span class="o">=</span> <span class="n">g</span> <span class="o">*</span> <span class="n">tau</span>
    <span class="k">return</span> <span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">v0</span> <span class="o">-</span> <span class="n">v_inf</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="n">tau</span><span class="p">))</span> <span class="o">+</span> <span class="n">v_inf</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">y0</span>

<span class="c1"># Units     (m/s) (m/s) (s)    (s)</span>
<span class="n">var_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;u0&quot;</span><span class="p">,</span> <span class="s2">&quot;v0&quot;</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">]</span>

<span class="c1">## Assemble model</span>
<span class="n">md_trajectory</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">gr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;Trajectory Model&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">cp_function</span><span class="p">(</span>
        <span class="n">fun</span><span class="o">=</span><span class="n">fun_x</span><span class="p">,</span>
        <span class="n">var</span><span class="o">=</span><span class="n">var_list</span><span class="p">,</span>
        <span class="n">out</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_trajectory&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">cp_function</span><span class="p">(</span>
        <span class="n">fun</span><span class="o">=</span><span class="n">fun_y</span><span class="p">,</span>
        <span class="n">var</span><span class="o">=</span><span class="n">var_list</span><span class="p">,</span>
        <span class="n">out</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;y_trajectory&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">cp_bounds</span><span class="p">(</span>
        <span class="n">u0</span><span class="o">=</span><span class="n">u0_bounds</span><span class="p">,</span>
        <span class="n">v0</span><span class="o">=</span><span class="n">v0_bounds</span><span class="p">,</span>
        <span class="n">tau</span><span class="o">=</span><span class="n">tau_bounds</span><span class="p">,</span>
        <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">md_trajectory</span><span class="o">.</span><span class="n">printpretty</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model: Trajectory Model

  inputs:
    var_det:
      u0: [0.0, 22.000000000000014]
      v0: [0.9999999999999778, 32.99999999999998]
      t: [0, 60]
      tau: [0.06422436149609652, 13.816485066214396]

    var_rand:

    copula:
      None

  functions:
      x_trajectory: [&#39;u0&#39;, &#39;v0&#39;, &#39;tau&#39;, &#39;t&#39;] -&gt; [&#39;x&#39;]
      y_trajectory: [&#39;u0&#39;, &#39;v0&#39;, &#39;tau&#39;, &#39;t&#39;] -&gt; [&#39;y&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fit-the-model-with-nonlinear-least-squares">
<h2><span class="section-number">7.1.4. </span>Fit the Model with Nonlinear Least Squares<a class="headerlink" href="#fit-the-model-with-nonlinear-least-squares" title="Permalink to this headline">¶</a></h2>
<p>In the previous chapter we discussed <em>ordinary least squares</em>; fitting a model <em>linear in its features</em> to a dataset. Now we will consider <em>nonlinear least squares</em> (NLS); fitting a model <em>nonlinear in its features</em>. For more information, see the <a class="reference internal" href="../04_appendices/nls.html#nls"><span class="std std-ref">appendix entry on NLS</span></a>.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">gr.fit_nls()</span></code> routine to carry out NLS to find a best-fit value for <span class="math notranslate nohighlight">\(\theta\)</span>. This function takes a model and a datset, infers the outputs (<code class="docutils literal notranslate"><span class="pre">out</span></code>), the variables to set constant (<code class="docutils literal notranslate"><span class="pre">var_fix</span></code>), the variables to treat as features in the dataset (<code class="docutils literal notranslate"><span class="pre">var_feat</span></code>), and the variables to treat as parameters for optimization. The routine uses the bound information from the model to impose during optimization, and to inform the initial guess <span class="math notranslate nohighlight">\(\theta_0\)</span>.</p>
<p>Furthermore setting <code class="docutils literal notranslate"><span class="pre">uq_method=&quot;linpool&quot;</span></code> uses a linear approximation of the model to infer a distribution for the parameter vector <span class="math notranslate nohighlight">\(\theta\)</span>. This will allow us to simulate an ensemble of plausible trajectories that are compatible with our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">md_fit</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_windowed</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ft_nls</span><span class="p">(</span>
        <span class="n">md</span><span class="o">=</span><span class="n">md_trajectory</span><span class="p">,</span>
        <span class="n">uq_method</span><span class="o">=</span><span class="s2">&quot;linpool&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">md_fit</span><span class="o">.</span><span class="n">printpretty</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... fit_nls setting out = [&#39;y&#39;, &#39;x&#39;]
... eval_nls setting out = [&#39;y&#39;, &#39;x&#39;]
... eval_nls setting var_fix = []
... eval_nls setting var_feat = [&#39;t&#39;]
          u0         v0       tau  u0_0  v0_0     tau_0  success  \
0  18.792164  28.234799  2.802251  11.0  17.0  6.940355     True   

                                            message  n_iter       mse  
0  CONVERGENCE: NORM_OF_PROJECTED_GRADIENT_&lt;=_PGTOL      19  0.093358  
... provided columns intersect model output.
eval_df() is dropping {&#39;y&#39;, &#39;x&#39;}
model: Trajectory Model (Fitted)

  inputs:
    var_det:
      t: (unbounded)

    var_rand:
      u0: (+0) norm, {&#39;loc&#39;: 18.792164108555788, &#39;scale&#39;: 0.17265625005146742}
      v0: (+0) norm, {&#39;loc&#39;: 28.234799030915262, &#39;scale&#39;: 0.19741816344413898}
      tau: (+0) norm, {&#39;loc&#39;: 2.8022508095940344, &#39;scale&#39;: 0.12681169895779346}

    copula:
      Gaussian copula with correlations:
  var1 var2      corr
0   u0   v0  0.000000
1   u0  tau -0.678972
2   v0  tau -0.704769

  functions:
      Trajectory Model: [&#39;tau&#39;, &#39;u0&#39;, &#39;t&#39;, &#39;v0&#39;] -&gt; [&#39;y&#39;, &#39;x&#39;]
</pre></div>
</div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">ft_nls()</span></code> is a fitting routine, so it returns a model. Also note that the new model has normal marginals for the fitted parameters; the assumptions underlying the <code class="docutils literal notranslate"><span class="pre">linpool</span></code> UQ method result in a multivariate Gaussian distribution for the parameters. Evaluating the model with <code class="docutils literal notranslate"><span class="pre">ev_monte_carlo()</span></code> draws samples from the fitted parameter distribution, allowing us to visualize a “cone of uncertainty” associated with our fitted model. This will give us a visual sense of output variability, which is helpful for judging if the data lie near or far from the model results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_res_windowed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">md_fit</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ev_monte_carlo</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">df_det</span><span class="o">=</span><span class="n">df_windowed</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_line</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_res_windowed</span><span class="p">,</span> 
        <span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s2">&quot;tau&quot;</span><span class="p">),</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> 
        <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">df_windowed</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Range (m)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Height (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... provided columns intersect model output.
eval_df() is dropping {&#39;y&#39;, &#39;x&#39;}
</pre></div>
</div>
<img alt="../_images/model-form-error_16_1.png" src="../_images/model-form-error_16_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781379417105)&gt;
</pre></div>
</div>
</div>
</div>
<p>Stop and ask yourself “is this model validated?” Qualitatively the fit seems to be quite good. Based on these results alone, we might be tempted to say the model is validated. However, keep in mind that NLS chooses the <em>best</em> parameter values <span class="math notranslate nohighlight">\(\theta\)</span> to fit the data at hand; like with an empirical model, assessing a fitted physics-based model against its training data will tend to give an optimistic sense of model accuracy.</p>
<p>There two analyses we should complete before declaring this model validated: We should <em>inspect residuals</em>, and we should check our model against <em>validation data</em>.</p>
</div>
<div class="section" id="inspect-the-residuals">
<h2><span class="section-number">7.1.5. </span>Inspect the Residuals<a class="headerlink" href="#inspect-the-residuals" title="Permalink to this headline">¶</a></h2>
<p>A <em>residual</em> is a discrepancy between the observed and modeled values, that is</p>
<div class="math notranslate nohighlight">
\[r_i = \hat{f}_i(\theta) - f_i.\]</div>
<p>The quantity <span class="math notranslate nohighlight">\(r_i\)</span> is “residual” in the sense that it is what is “left over” after fitting a model. A classical idea in statistics is to study the residuals after fitting, in order to determine if there are patterns “left over” that the fitted model does not capture <span id="id1">[<a class="reference internal" href="../zbib.html#id2">MT77</a>]</span>. Obvious patterns may suggest our model is inadequate; or in the case of a physical model, that our modeling assumptions were erroneous.</p>
<p>First we compute the residuals at the nominal (best-fit) model results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_resid_windowed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">md_fit</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ev_nominal</span><span class="p">(</span><span class="n">df_det</span><span class="o">=</span><span class="n">df_windowed</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_transmute</span><span class="p">(</span><span class="n">x_pred</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_bind_cols</span><span class="p">(</span><span class="n">df_windowed</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]])</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span>
        <span class="n">x_resid</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">x_pred</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y_resid</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... provided columns intersect model output.
eval_df() is dropping {&#39;y&#39;, &#39;x&#39;}
</pre></div>
</div>
</div>
</div>
<p>Next we construct a residual-vs-feature plot; in this case <code class="docutils literal notranslate"><span class="pre">x_resid,</span> <span class="pre">y_resid</span></code> against <code class="docutils literal notranslate"><span class="pre">t</span></code>. We also add a smoothed trendline to help visualize the trends in the residuals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span>
        <span class="n">df_resid_windowed</span> <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_gather</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;resid&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x_resid&quot;</span><span class="p">,</span> <span class="s2">&quot;y_resid&quot;</span><span class="p">]),</span> 
        <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;resid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;var&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">scale_color_manual</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_resid</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">y_resid</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Residual&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Residual (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: Confidence intervals are not yet implementedfor lowess smoothings.
</pre></div>
</div>
<img alt="../_images/model-form-error_21_1.png" src="../_images/model-form-error_21_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781379611117)&gt;
</pre></div>
</div>
</div>
</div>
<p>If all our model was missing was the noise on our measurements, then we would expect the residuals to be randomly distributed about zero; the residuals should have no coherent pattern across time (or any other feature). This residual plot shows that there is some “residual” pattern that our model does not capture. In the <code class="docutils literal notranslate"><span class="pre">y</span></code> coordinate, the projectile is first too high (<code class="docutils literal notranslate"><span class="pre">y_resid</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>) then too low (<code class="docutils literal notranslate"><span class="pre">y_resid</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>). Note how these patterns are much easier to see in a residual plot, rather than in a “straight” comparison against the data.</p>
<p>Of course, we will not always have a single feature in our model. In the more general case, we can plot the residual <span class="math notranslate nohighlight">\(r_i\)</span> against its predicted value <span class="math notranslate nohighlight">\(\hat{f}_i\)</span>. The next figure shows <code class="docutils literal notranslate"><span class="pre">x_resid</span></code> against <code class="docutils literal notranslate"><span class="pre">x_pred</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span>
        <span class="n">df_resid_windowed</span><span class="p">,</span>
        <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x_pred&quot;</span><span class="p">,</span> <span class="s2">&quot;x_resid&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Predicted x (m)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Residual x (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: Confidence intervals are not yet implementedfor lowess smoothings.
</pre></div>
</div>
<img alt="../_images/model-form-error_23_1.png" src="../_images/model-form-error_23_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781379748189)&gt;
</pre></div>
</div>
</div>
</div>
<p>Since the projectile is advancing steadily, this plot is very similar to the one above. Again, we see a strong pattern in the residuals, suggesting the model is underfit, possibly by erroneous modeling choices. Note that plotting the residual against its predicted value is recommended over plotting the residual against the <em>observed</em> value, as the latter approach can lead to misleading plots <span id="id2">[<a class="reference internal" href="../zbib.html#id15">GHV20</a>]</span>.</p>
</div>
<div class="section" id="inspect-model-with-validation-data">
<h2><span class="section-number">7.1.6. </span>Inspect Model with Validation Data<a class="headerlink" href="#inspect-model-with-validation-data" title="Permalink to this headline">¶</a></h2>
<p><em>Validation data</em> are data which have been purposefully held-out of the model-building process, and set aside for the purposes of assessing the model. Ideally, the person building the model should not get to “see” these data before testing the model <span id="id3">[<a class="reference internal" href="../zbib.html#id4">JWHT13</a>]</span>. As discussed in the chapter on Model Flexibility, our data-splitting scheme should be tailored to our intended use.</p>
<p>Here we evaluate the model on the Full dataset and inspect the fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_res_full</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">md_fit</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ev_monte_carlo</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">df_det</span><span class="o">=</span><span class="n">df_full</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_line</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_res_full</span><span class="p">,</span> 
        <span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s2">&quot;tau&quot;</span><span class="p">),</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> 
        <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">df_full</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Range (m)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Height (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... provided columns intersect model output.
eval_df() is dropping {&#39;y&#39;, &#39;x&#39;}
</pre></div>
</div>
<img alt="../_images/model-form-error_26_1.png" src="../_images/model-form-error_26_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781379746125)&gt;
</pre></div>
</div>
</div>
</div>
<p>Here the inadequacy of the fit is obvious; the simulated projectile is widely overshooting the real trajectory. The real projectile is also much lower at its endtime, as compared with the end of each simulated trajectory (which are much too high at the same time). It appears the simulated projectile is moving too fast towards its peak, suggesting that the initial speed is too large or the drag force is too small.</p>
<p>A residual plot gives an evern sharper look at this lack of fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_res_resid</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">md_fit</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ev_nominal</span><span class="p">(</span><span class="n">df_det</span><span class="o">=</span><span class="n">df_full</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_transmute</span><span class="p">(</span><span class="n">x_pred</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_bind_cols</span><span class="p">(</span><span class="n">df_full</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]])</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span>
        <span class="n">x_resid</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">x_pred</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y_resid</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_gather</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;resid&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x_resid&quot;</span><span class="p">,</span> <span class="s2">&quot;y_resid&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">df_res_resid</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;resid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;var&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">scale_color_manual</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_resid</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">y_resid</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Residual&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Residual (m)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... provided columns intersect model output.
eval_df() is dropping {&#39;y&#39;, &#39;x&#39;}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: Confidence intervals are not yet implementedfor lowess smoothings.
</pre></div>
</div>
<img alt="../_images/model-form-error_28_2.png" src="../_images/model-form-error_28_2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8781380360677)&gt;
</pre></div>
</div>
</div>
</div>
<p>These two plots indicate that the model is incapable of making accurate predictions for this scenario: It has <em>model-form error</em> that precludes predictive accuracy.</p>
</div>
<div class="section" id="exercise">
<h2><span class="section-number">7.1.7. </span>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h2>
<p>We’ve seen that we can’t make a successful prediction with this model, but can the model represent the full trajectory at all? Try fitting the trajectory model <code class="docutils literal notranslate"><span class="pre">md_trajectory</span></code> to <code class="docutils literal notranslate"><span class="pre">df_full</span></code>; can you accurately represent the data using this model?</p>
</div>
<div class="section" id="recognize-model-form-error">
<h2><span class="section-number">7.1.8. </span>Recognize Model-form Error<a class="headerlink" href="#recognize-model-form-error" title="Permalink to this headline">¶</a></h2>
<p>Model-form error (sometimes called model discrepancy) occurs when the model in use cannot accurately represent the underlying physics <span id="id4">[<a class="reference internal" href="../zbib.html#id5">Smi13</a>]</span>. The inability of the linear drag model to fit the data indicates that there is model-form error.</p>
<p>In truth, the data above were generated not with a linear drag law, but rather with a <em>quadratic</em> drag law:</p>
<div class="math notranslate nohighlight">
\[F_x(u, v) = - b u^2 / \sqrt{u^2+v^2}\]</div>
<div class="math notranslate nohighlight">
\[F_y(u, v) = - b v^2 / \sqrt{u^2+v^2}\]</div>
<p>This is the specific model-form error in the present case study. The uncaptured nonlinearity in the drag force leads to an erroneous trajectory, explaining the results we saw above. For instance, the nonlinear drag law breaks the left-right symmetry of the trajectory, a feature of the trajectory that the linear drag model cannot represent.</p>
<p>In general, model-form errors are simultaneously <em>the most consequential source of uncertainty</em> in physical modeling and <em>the most difficult source of uncertainty</em> to address.</p>
</div>
<div class="section" id="address-model-form-errors">
<h2><span class="section-number">7.1.9. </span>Address Model-form Errors<a class="headerlink" href="#address-model-form-errors" title="Permalink to this headline">¶</a></h2>
<p>There are two broad approaches to addressing model-form errors <span id="id5">[<a class="reference internal" href="../zbib.html#id5">Smi13</a>]</span>:</p>
<ol class="simple">
<li><p>Improve the physical model</p></li>
<li><p>Model the discrepancy</p></li>
</ol>
<p>One can <strong>improve the physical model</strong> by hunting down missing physics or erroneous assumptions and correcting those mistakes. Since the present case study is synthetic, the model-form error can be totally corrected by exchanging the linear drag law for a quadratic one. However this will not always be possible, as our understanding of physics is incomplete. There are no generic techniques for improving the physical model, as doing so requires domain-specific knowledge of the problem, and a sufficiently accurate physics-based model may not presently exist.</p>
<p>Rather than take a physics-based approach, one may alternatively <strong>model the discrepancy</strong>. Using the empirical modeling techniques discussed in the chapter on model flexibility, one can fit a model for the discrepancy between model results and measured data.</p>
<p>For instance, in the present case study the (horizontal) linear drag force is given as a function of physical quantities <span class="math notranslate nohighlight">\(F_x = F_x(u, v; \tau)\)</span>. One could introduce additional parameters in an empirical model <span class="math notranslate nohighlight">\(\hat{F}_x = \hat{F}_x(u, v; \tau, \theta) = F_x(u, v; \tau) + \delta_x(u, v; \theta)\)</span>. The new discrepancy term <span class="math notranslate nohighlight">\(\delta\)</span> would compensate for the incorrect physical assumptions, with the new <span class="math notranslate nohighlight">\(\theta\)</span> tuned during NLS fitting.</p>
<p>In the chapter on principled predictions, we will demonstrate how to fit such a discrepancy model, and how to quantify uncertainty within this framework.</p>
</div>
<div class="section" id="key-takeaways">
<h2><span class="section-number">7.1.10. </span>Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Nonlinear least squares (NLS) can help us find best-fit parameter values (and even a parameter distribution) for a physics-based model. However, assessing a fitted physics-based model against its training data will give an optimistic sense of accuracy.</p></li>
<li><p>Residual plots help us detect missing patterns in a model and can help identify cases of model-form error.</p></li>
<li><p>Validation data is data withheld from the model during training, and can be used for an “honest” assessment of model accuracy.</p></li>
<li><p>Model-form error occurs when the model has missing or incorrect physical behavior(s); both residual plots and validation data can help to identify model-form errors.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./02_diagnosing"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="functions.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">7. </span>Functions</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../03_advancing/advancing.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">8. </span>Advancing</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Zachary del Rosario, Gianluca Iaccarino<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>